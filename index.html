<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>EXPERTA INMOBILIARIA — Panel</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <style>
    :root{
      --accent: #0b76ff;
    }
    header.site-header{
      background: linear-gradient(135deg, rgba(11,118,255,0.12), rgba(11,118,255,0.04));
      padding: 2rem 1rem;
      margin-bottom: 1.25rem;
      border-radius: 12px;
    }
    .hero {
      display:grid;
      grid-template-columns: 1fr;
      gap:1rem;
      align-items:center;
    }
    @media(min-width:800px){
      .hero{ grid-template-columns: 1fr 420px; }
    }
    .cards { display: grid; grid-template-columns: repeat(auto-fit,minmax(260px,1fr)); gap:1rem; }
    .card img { width:100%; height:180px; object-fit:cover; border-radius:8px; margin-bottom:0.5rem;}
    .muted { color: #6b7280; font-size:0.95rem;}
    .controls { display:flex; gap:.5rem; flex-wrap:wrap; }
    main.container { padding-bottom:3rem; }
    .negative-space { margin-top: -1.25rem; }
    .detail-modal { position: fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,0.35); padding:20px; z-index:50; }
    .detail-modal .panel { max-width:900px; width:100%; background:white; padding:1.25rem; border-radius:10px; box-shadow:0 8px 30px rgba(0,0,0,0.15); }
    .visible { display:flex !important; }
    footer.site-footer { margin-top:2rem; color:#374151; font-size:0.95rem; }
    .tag { background: rgba(11,118,255,0.08); color:var(--accent); padding:.15rem .5rem; border-radius:6px; font-weight:600; font-size:.85rem;}
  </style>
</head>
<body>
  <nav>
    <ul>
      <li><strong>EXPERTA INMOBILIARIA</strong></li>
      <li><a href="#nueva">Nueva publicación</a></li>
      <li><a href="#listado">Listado</a></li>
      <li><a id="openSettings" href="#ajustes">Ajustes</a></li>
    </ul>
  </nav>

  <main class="container">
    <header class="site-header">
      <div class="hero">
        <div>
          <h1>EXPERTA INMOBILIARIA</h1>
          <p class="muted">Panel de administración — crea, edita y elimina publicaciones. Al ver una publicación puedes contactar vía WhatsApp con un mensaje prellenado.</p>
          <div class="controls negative-space" style="margin-top:1rem;">
            <button id="btnNew" class="contrast">Nueva publicación</button>
            <button id="btnClear" class="secondary">Vaciar demo</button>
            <a href="#" id="btnImport" class="secondary">Importar ejemplo</a>
          </div>
        </div>
        <figure>
          <img src="https://source.unsplash.com/600x420/?real-estate,house" alt="Imagen inmobiliaria">
          <figcaption class="muted">Imagen dinámica de Unsplash (cambia cada carga).</figcaption>
        </figure>
      </div>
    </header>

    <section id="nueva">
      <article>
        <h2 id="formTitle">Crear nueva publicación</h2>
        <form id="propForm">
          <div class="grid">
            <label for="title">Título</label>
            <input id="title" name="title" required placeholder="Ej: Departamento 2D en Recoleta">
            <label for="price">Precio (USD)</label>
            <input id="price" name="price" type="number" min="0" placeholder="120000">
            <label for="location">Ubicación</label>
            <input id="location" name="location" placeholder="Ciudad, Barrio">
            <label for="desc">Descripción</label>
            <textarea id="desc" name="desc" rows="4" placeholder="Descripción breve del inmueble"></textarea>
            <label for="img">URL imagen (opcional)</label>
            <input id="img" name="img" placeholder="https://... (si no, se usa Unsplash)">
          </div>
          <input type="hidden" id="propId">
          <div style="margin-top:.5rem;">
            <button type="submit" class="primary">Guardar publicación</button>
            <button type="button" id="cancelEdit" class="secondary">Cancelar</button>
          </div>
        </form>
      </article>
    </section>

    <section id="ajustes" style="margin-top:1.25rem;">
      <h3>Ajustes</h3>
      <p class="muted">Configura el número de WhatsApp al que serán dirigidos los contactos (formato internacional, ej: 5491123456789 sin '+').</p>
      <form id="settingsForm" style="max-width:520px;">
        <label for="waNumber">Número WhatsApp</label>
        <input id="waNumber" placeholder="5491123456789">
        <label for="waGreeting">Mensaje por defecto (opcional)</label>
        <input id="waGreeting" placeholder="Hola, estoy interesado en este inmueble...">
        <div style="margin-top:.5rem;">
          <button class="primary" type="submit">Guardar ajustes</button>
          <button id="resetSettings" class="secondary" type="button">Restaurar valores</button>
        </div>
      </form>
    </section>

    <section id="listado" style="margin-top:1.5rem;">
      <h2>Publicaciones</h2>
      <div id="cards" class="cards"></div>
      <p id="emptyNotice" class="muted" style="margin-top:1rem;">Aún no hay publicaciones. Crea la primera arriba.</p>
    </section>

    <div id="detailModal" class="detail-modal" role="dialog" aria-modal="true" aria-hidden="true">
      <div class="panel">
        <div style="display:flex; gap:1rem; align-items:flex-start;">
          <div style="flex:1;">
            <h3 id="d-title">Título</h3>
            <p id="d-location" class="muted">Ubicación</p>
            <p id="d-price" class="tag">Precio</p>
            <p id="d-desc" style="margin-top:.5rem;">Descripción</p>
            <div style="margin-top:1rem; display:flex; gap:.5rem; flex-wrap:wrap;">
              <a id="waLink" class="contrast" href="#" target="_blank" rel="noopener">Contactar por WhatsApp</a>
              <button id="dClose" class="secondary">Cerrar</button>
            </div>
          </div>
          <div style="width:320px;">
            <img id="d-img" src="" alt="Imagen inmueble" style="width:100%; height:220px; object-fit:cover; border-radius:8px;">
          </div>
        </div>
      </div>
    </div>

    <footer class="site-footer">
      <small>Demo creada para <strong>EXPERTA INMOBILIARIA</strong>. Usa <em>localStorage</em> para almacenar datos localmente en tu navegador.</small>
    </footer>
  </main>

  <script>
    const STORAGE_KEY = 'experta_inmobiliaria_posts_v1';
    const SETTINGS_KEY = 'experta_inmobiliaria_settings_v1';

    const form = document.getElementById('propForm');
    const cardsEl = document.getElementById('cards');
    const emptyNotice = document.getElementById('emptyNotice');
    const propIdInput = document.getElementById('propId');
    const formTitle = document.getElementById('formTitle');
    const cancelEdit = document.getElementById('cancelEdit');
    const btnNew = document.getElementById('btnNew');
    const btnClear = document.getElementById('btnClear');
    const btnImport = document.getElementById('btnImport');

    const detailModal = document.getElementById('detailModal');
    const dTitle = document.getElementById('d-title');
    const dLocation = document.getElementById('d-location');
    const dPrice = document.getElementById('d-price');
    const dDesc = document.getElementById('d-desc');
    const dImg = document.getElementById('d-img');
    const waLink = document.getElementById('waLink');
    const dClose = document.getElementById('dClose');

    const settingsForm = document.getElementById('settingsForm');
    const waNumber = document.getElementById('waNumber');
    const waGreeting = document.getElementById('waGreeting');
    const resetSettings = document.getElementById('resetSettings');
    const openSettings = document.getElementById('openSettings');

    function readPosts(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)) || []; }catch(e){ return []; } }
    function writePosts(posts){ localStorage.setItem(STORAGE_KEY, JSON.stringify(posts)); }
    function readSettings(){ try{ return JSON.parse(localStorage.getItem(SETTINGS_KEY)) || {} }catch(e){ return {}; } }
    function writeSettings(s){ localStorage.setItem(SETTINGS_KEY, JSON.stringify(s)); }
    function uid(){ return 'p_' + Date.now() + '_' + Math.floor(Math.random()*9000+1000); }

    function render(){
      const posts = readPosts();
      cardsEl.innerHTML = '';
      if(!posts.length){ emptyNotice.style.display = 'block'; return; }
      emptyNotice.style.display = 'none';
      posts.slice().reverse().forEach(post => {
        const card = document.createElement('article');
        card.className = 'card';
        const img = document.createElement('img');
        img.alt = post.title || 'Imagen inmueble';
        img.src = post.img || (`https://source.unsplash.com/600x420/?house,apartment,home&sig=${post._sig||post.id}`);
        const h = document.createElement('h3'); h.textContent = post.title || 'Sin título';
        const pLoc = document.createElement('p'); pLoc.className='muted'; pLoc.textContent = post.location || '';
        const pPrice = document.createElement('p'); pPrice.innerHTML = `<span class="tag">$ ${post.price || '—'}</span>`;
        const actions = document.createElement('p');

        const viewBtn = document.createElement('button'); viewBtn.textContent='Ver'; viewBtn.className='secondary';
        viewBtn.onclick = ()=> openDetail(post.id);

        const editBtn = document.createElement('button'); editBtn.textContent='Editar'; editBtn.className='warning';
        editBtn.onclick = ()=> loadForEdit(post.id);

        const delBtn = document.createElement('button'); delBtn.textContent='Eliminar'; delBtn.className='danger';
        delBtn.onclick = ()=> { if(!confirm('¿Eliminar publicación?')) return; deletePost(post.id); };

        actions.append(viewBtn, editBtn, delBtn);
        card.append(img, h, pLoc, pPrice, actions);
        cardsEl.appendChild(card);
      });
    }

    function savePost(data){
      const posts = readPosts();
      if(data.id){
        const idx = posts.findIndex(p=>p.id===data.id);
        if(idx>-1){ posts[idx] = { ...posts[idx], ...data }; }
      } else {
        data.id = uid();
        data._sig = Math.floor(Math.random()*100000);
        posts.push(data);
      }
      writePosts(posts);
      render();
    }
    function deletePost(id){ let posts = readPosts(); posts = posts.filter(p=>p.id!==id); writePosts(posts); render(); }
    function loadForEdit(id){
      const p = readPosts().find(x=>x.id===id);
      if(!p) return alert('Publicación no encontrada');
      document.getElementById('title').value = p.title || '';
      document.getElementById('price').value = p.price || '';
      document.getElementById('location').value = p.location || '';
      document.getElementById('desc').value = p.desc || '';
      document.getElementById('img').value = p.img || '';
      propIdInput.value = p.id;
      formTitle.textContent = 'Editar publicación';
      window.location.hash = '#nueva';
    }
    function openDetail(id){
      const p = readPosts().find(x=>x.id===id);
      if(!p) return alert('Publicación no encontrada');
      dTitle.textContent = p.title || 'Sin título';
      dLocation.textContent = p.location || '';
      dPrice.textContent = '$ ' + (p.price || '—');
      dDesc.textContent = p.desc || '';
      dImg.src = p.img || `https://source.unsplash.com/800x600/?house,apartment,interior&sig=${p._sig||p.id}`;
      const settings = readSettings();
      const num = (settings.whatsappNumber || '').replace(/[^0-9]/g,'');
      const greeting = settings.whatsappGreeting || '';
      const pre = greeting ? greeting + ' ' : 'Hola, ';
      const message = `${pre}estoy interesado en el inmueble "${p.title || 'sin título'}". ¿Está disponible?`;
      if(!num){
        waLink.href = '#';
        waLink.onclick = (e)=>{ e.preventDefault(); alert('Configura un número de WhatsApp en Ajustes.'); };
      } else {
        waLink.href = `https://wa.me/${num}?text=` + encodeURIComponent(message);
        waLink.onclick = null;
      }
      detailModal.classList.add('visible');
      detailModal.setAttribute('aria-hidden','false');
    }

    form.addEventListener('submit', (e)=>{
      e.preventDefault();
      const data = {
        title: document.getElementById('title').value.trim(),
        price: document.getElementById('price').value.trim(),
        location: document.getElementById('location').value.trim(),
        desc: document.getElementById('desc').value.trim(),
        img: document.getElementById('img').value.trim(),
      };
      const id = propIdInput.value;
      if(id) data.id = id;
      savePost(data);
      form.reset();
      propIdInput.value = '';
      formTitle.textContent = 'Crear nueva publicación';
      window.location.hash = '#listado';
    });
    cancelEdit.addEventListener('click', ()=>{ form.reset(); propIdInput.value = ''; formTitle.textContent = 'Crear nueva publicación'; });
    dClose.addEventListener('click', ()=>{ detailModal.classList.remove('visible'); detailModal.setAttribute('aria-hidden','true'); });
    detailModal.addEventListener('click', (e)=>{ if(e.target === detailModal){ detailModal.classList.remove('visible'); detailModal.setAttribute('aria-hidden','true'); } });
    btnNew.addEventListener('click', ()=>{ form.reset(); propIdInput.value = ''; formTitle.textContent = 'Crear nueva publicación'; window.location.hash = '#nueva'; });
    btnClear.addEventListener('click', ()=>{ if(confirm('¿Vaciar publicaciones?')) { writePosts([]); render(); } });
    btnImport.addEventListener('click', (e)=>{ e.preventDefault(); importSample(); });

    function loadSettingsToForm(){ const s = readSettings(); waNumber.value = s.whatsappNumber || ''; waGreeting.value = s.whatsappGreeting || 'Hola,'; }
    settingsForm.addEventListener('submit', (e)=>{ e.preventDefault(); writeSettings({ whatsappNumber: waNumber.value.trim(), whatsappGreeting: waGreeting.value.trim() }); alert('Ajustes guardados'); });
    resetSettings.addEventListener('click', ()=>{ localStorage.removeItem(SETTINGS_KEY); loadSettingsToForm(); alert('Ajustes restaurados'); });
    openSettings.addEventListener('click', ()=>{ window.location.hash = '#ajustes'; loadSettingsToForm(); });

    function importSample(){
      const sample = [
        { id: uid(), title: 'Departamento 2D moderno', price:'120000', location:'Centro', desc:'Luminoso, 2 dormitorios, balcón con vista.', _sig:101 },
        { id: uid(), title: 'Casa familiar con patio', price:'220000', location:'Bº Jardín', desc:'3 dormitorios, gran jardín y cochera.', _sig:102 },
        { id: uid(), title: 'Monoambiente para inversor', price:'65000', location:'Microcentro', desc:'Monoambiente alquilado, ROI 6% anual.', _sig:103 },
      ];
      writePosts(sample); render(); alert('Ejemplo importado.');
    }

    (function init(){
      if(!localStorage.getItem(STORAGE_KEY)){ writePosts([]); }
      if(!localStorage.getItem(SETTINGS_KEY)){ writeSettings({ whatsappNumber: '', whatsappGreeting: 'Hola,' }); }
      loadSettingsToForm(); render();
    })();
    document.addEventListener('keydown', (e)=>{ if(e.key === 'Escape'){ detailModal.classList.remove('visible'); detailModal.setAttribute('aria-hidden','true'); } });
  </script>
</body>
</html>
